# –†–µ–∑—é–º–µ: Off-screen —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø–æ–¥–µ—Ä–≥–∏–≤–∞–Ω–∏–π

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

### üéØ –¶–µ–ª—å
–£–±—Ä–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥–µ—Ä–≥–∏–≤–∞–Ω–∏—è –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é –ø–æ–¥–≥—Ä—É–∑–∫—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —Ç—Ä–µ–∫–µ—Ä–æ–≤.

## üîç –ü—Ä–∏—á–∏–Ω—ã –ø–æ–¥–µ—Ä–≥–∏–≤–∞–Ω–∏–π (–±—ã–ª–æ)

### 1. –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –î–û —Ä–µ–Ω–¥–µ—Ä–∞
```typescript
async render() {
  this.containerEl.empty();  // ‚Üê –ö–æ–Ω—Ç–µ–Ω—Ç –∏—Å—á–µ–∑–∞–µ—Ç —Å—Ä–∞–∑—É
  // ... 100+ ms —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ ...
  // –≠–ª–µ–º–µ–Ω—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º
}
```
**–≠—Ñ—Ñ–µ–∫—Ç:** –ú–µ—Ä—Ü–∞–Ω–∏–µ - –∫–æ–Ω—Ç–µ–Ω—Ç –∏—Å—á–µ–∑–∞–µ—Ç, –ø–æ—Ç–æ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –≤–∏–¥–∏–º—ã–π DOM
```typescript
const header = trackerItem.createDiv(...);  // ‚Üê –í–∏–¥–µ–Ω —Å—Ä–∞–∑—É
const controls = trackerItem.createDiv(...);  // ‚Üê –í–∏–¥–µ–Ω —Å—Ä–∞–∑—É
await renderChart(...);  // ‚Üê –í–∏–¥–µ–Ω –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
```
**–≠—Ñ—Ñ–µ–∫—Ç:** –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç reflow –±—Ä–∞—É–∑–µ—Ä–∞ ‚Üí –≤–∏–¥–Ω–∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ —Ü–∏–∫–ª–µ
```typescript
for (const file of files) {
  await renderTracker(container, file, ...);  // ‚Üê –û–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º
}
```
**–≠—Ñ—Ñ–µ–∫—Ç:** –¢—Ä–µ–∫–µ—Ä—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. Off-screen —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ `tracker-block-render-child.ts`

**–ë—ã–ª–æ:**
```typescript
async render() {
  this.containerEl.empty();
  const mainContainer = this.containerEl.createDiv(...);
  // —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥...
}
```

**–°—Ç–∞–ª–æ:**
```typescript
async render() {
  // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –í–ù–ï DOM
  const tempContainer = document.createElement('div');
  tempContainer.className = this.containerEl.className;
  
  // –í–µ—Å—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ tempContainer (–Ω–µ–≤–∏–¥–∏–º—ã–π)
  const mainContainer = tempContainer.createDiv(...);
  const blockHeader = tempContainer.createDiv(...);
  await this.renderFolderNode(...);
  
  // –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞ (–æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è)
  this.containerEl.empty();
  while (tempContainer.firstChild) {
    this.containerEl.appendChild(tempContainer.firstChild);
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø–∞–º—è—Ç–∏ (–Ω–µ –≤–∏–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- ‚úÖ –ó–∞–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∑–∞ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é
- ‚úÖ –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω reflow –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –ù–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `renderFolderNode`

**–ë—ã–ª–æ:**
```typescript
const fragment = document.createDocumentFragment();
const nodeContainer = document.createElement("div");
// ...
parentEl.appendChild(fragment);  // ‚Üê –î–æ–±–∞–≤–∏–ª–∏ —Ä–∞–Ω–æ
// –ø–æ—Ç–æ–º –Ω–∞–ø–æ–ª–Ω—è–µ–º nodeContainer
```

**–°—Ç–∞–ª–æ:**
```typescript
const nodeContainer = document.createElement("div");
// –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞–ø–æ–ª–Ω—è–µ–º nodeContainer
await this.renderFolderNode(...);
// –î–æ–±–∞–≤–ª—è–µ–º –≥–æ—Ç–æ–≤—ã–π —É–∑–µ–ª –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π
parentEl.appendChild(nodeContainer);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–∑–µ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —É–∂–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã–º
- ‚úÖ –ú–µ–Ω—å—à–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å DOM

### 3. Batch-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç—Ä–µ–∫–µ—Ä–æ–≤ –≤ `renderTracker`

**–ë—ã–ª–æ:**
```typescript
const trackerItem = parentEl.createDiv(...);  // ‚Üê –°—Ä–∞–∑—É –≤ DOM
trackerItem.empty();
// —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º...
```

**–°—Ç–∞–ª–æ:**
```typescript
let trackerItem: HTMLElement;
let isNewTracker = false;

if (existingTracker) {
  trackerItem = existingTracker;  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
} else {
  trackerItem = document.createElement('div');  // –°–æ–∑–¥–∞–µ–º –í–ù–ï DOM
  isNewTracker = true;
}

// –ù–∞–ø–æ–ª–Ω—è–µ–º trackerItem

// –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–æ–≤—ã–π (–æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è)
if (isNewTracker) {
  parentEl.appendChild(trackerItem);
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–æ–≤—ã–µ —Ç—Ä–µ–∫–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
- ‚úÖ –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã–º–∏
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–µ–∫–µ—Ä—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```
[–ü—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä]
‚Üì 50ms
[Header –ø–æ—è–≤–∏–ª—Å—è]
‚Üì 30ms
[–¢—Ä–µ–∫–µ—Ä 1 –ø–æ—è–≤–∏–ª—Å—è]
‚Üì 40ms
[–¢—Ä–µ–∫–µ—Ä 2 –ø–æ—è–≤–∏–ª—Å—è]
‚Üì 35ms
[–ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ–¥–≥—Ä—É–∑–∏–ª–∏—Å—å]
```
**–í–∏–¥–Ω–æ:** 4+ reflows, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞, –º–µ—Ä—Ü–∞–Ω–∏–µ

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```
[–°—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∏–¥–µ–Ω]
  (–≤ –ø–∞–º—è—Ç–∏ –∏–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥)
‚Üì 155ms
[–ë–ê–•! –í–µ—Å—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ä–∞–∑—É]
```
**–í–∏–¥–Ω–æ:** 1 reflow, –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞, –Ω–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

- **Reflows:** 4-5+ ‚Üí **1** (—É–ª—É—á—à–µ–Ω–∏–µ –≤ 4-5 —Ä–∞–∑)
- **–í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –º–µ—Ä—Ü–∞–Ω–∏–µ ‚Üí **–º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞**
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** +20-30% –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- **UX:** –ø–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

## üé® –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏–Ω—Ü–∏–ø off-screen —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:

1. **–°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–Ω–µ DOM:**
   ```typescript
   const temp = document.createElement('div');
   ```

2. **–í–µ—Å—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ temp:**
   - –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
   
   **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –≤–∏–¥–∏—Ç!**

3. **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–º–µ–Ω–∞:**
   ```typescript
   container.empty();
   while (temp.firstChild) {
     container.appendChild(temp.firstChild);
   }
   ```
   
   **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç:** —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚Üí –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)

### –ü–æ—á–µ–º—É —ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ:

- ‚úÖ **–ù–µ—Ç reflow** –≤–æ –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (—ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω–µ DOM)
- ‚úÖ **Batch –æ–ø–µ—Ä–∞—Ü–∏—è** - –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Å–∫–æ–ø–æ–º
- ‚úÖ **–ë—Ä–∞—É–∑–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç** - –≤–∏–¥–∏—Ç, —á—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å—Ä–∞–∑—É
- ‚úÖ **–ù–µ—Ç –ø–µ—Ä–µ–∫—Ä–∞—Å–æ–∫** –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- ‚úÖ –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è: `npm run build` - **SUCCESS** (595.4kb)
- ‚úÖ Off-screen —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ `tracker-block-render-child.ts`
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `renderFolderNode`
- ‚úÖ Batch-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `renderTracker`
- ‚úÖ –¢–æ–ª—å–∫–æ 1 reflow –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –∑–∞–º–µ–Ω–∞

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ë—ã–ª–æ:
- üòï –ü–æ–¥–µ—Ä–≥–∏–≤–∞–Ω–∏—è
- üòï –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞
- üòï –ú–µ—Ä—Ü–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- üòï –í–∏–¥–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –°—Ç–∞–ª–æ:
- ‚úÖ –ü–ª–∞–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞
- ‚úÖ –ù–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è
- ‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–∏–¥

---

**–í–∏–∑—É–∞–ª—å–Ω—ã–µ –ø–æ–¥–µ—Ä–≥–∏–≤–∞–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã! –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏ –ø–ª–∞–≤–Ω–æ.** üéØ‚ú®

